// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-ndarray-like@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gdot@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gaxpy@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dscal@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-exp@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-expit@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-shape2strides@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-vind2bind@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@esm/index.mjs";import _ from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-number@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import x from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@esm/index.mjs";import R from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import O from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import V from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@esm/index.mjs";import z from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@esm/index.mjs";import k from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@esm/index.mjs";import F from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@esm/index.mjs";import L from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@esm/index.mjs";import P from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@esm/index.mjs";import A from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@esm/index.mjs";import M from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@esm/index.mjs";import S from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@esm/index.mjs";import q from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@esm/index.mjs";import H from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@esm/index.mjs";import N from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@esm/index.mjs";import W from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@esm/index.mjs";import B from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array@esm/index.mjs";import I from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import C from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";var D=n,G=a,Y=s,J=o.ndarray,K=d.ndarray,Q=l,U=p,X=m,Z=u,$=h,tt=c,et=f,it=g,rt=v,nt=b,st=j,at={basic:"_basicLearningRate",constant:"_constantLearningRate",invscaling:"_inverseScalingLearningRate",pegasos:"_pegasosLearningRate"},ot={hinge:"_hingeLoss",log:"_logLoss",modifiedHuber:"_modifiedHuberLoss",perceptron:"_perceptronLoss",squaredHinge:"_squaredHingeLoss"};function dt(t,e){var i;return this._N=t,this._opts=e,this._scaleFactor=1,this._t=0,this._learningRateMethod=at[e.learningRate[0]],this._lossMethod=ot[e.loss],i=t,e.intercept&&(i+=1),this._weights=new et(i),this._coefficients=new it("float64",new et(i),[i],[1],0,"row-major"),this}D(dt.prototype,"_add",(function(t,e){var i=e/this._scaleFactor,r=this._weights;return K(t.shape[0],i,t.data,t.strides[0],t.offset,r,1,0),this._opts.intercept&&(r[this._N]+=i),this})),D(dt.prototype,"_basicLearningRate",(function(){return 10/(10+this._t)})),D(dt.prototype,"_constantLearningRate",(function(){return this._opts.learningRate[1]})),D(dt.prototype,"_dot",(function(t,e,i){var r=J(this._N,this._weights,1,0,t,e,i);return this._opts.intercept&&(r+=this._weights[this._N]),r*=this._scaleFactor})),D(dt.prototype,"_hingeLoss",(function(t,e){var i;return i=this[this._learningRateMethod](),this._regularize(i),e*this._dot(t.data,t.strides[0],t.offset)<1&&this._add(t,e*i),this})),D(dt.prototype,"_inverseScalingLearningRate",(function(){var t=this._opts.learningRate;return t[1]/$(this._t,t[2])})),D(dt.prototype,"_logLoss",(function(t,e){var i,r,n;return r=this[this._learningRateMethod](),this._regularize(r),n=this._dot(t.data,t.strides[0],t.offset),i=e/(1+Z(e*n)),this._add(t,r*i),this})),D(dt.prototype,"_modifiedHuberLoss",(function(t,e){var i,r;return i=this[this._learningRateMethod](),this._regularize(i),(r=e*this._dot(t.data,t.strides[0],t.offset))<-1?this._add(t,4*i*e):this._add(t,i*(e-r*e)),this})),D(dt.prototype,"_pegasosLearningRate",(function(){return 1/(this._opts.lambda*this._t)})),D(dt.prototype,"_perceptronLoss",(function(t,e){var i;return i=this[this._learningRateMethod](),this._regularize(i),e*this._dot(t.data,t.strides[0],t.offset)<=0&&this._add(t,e*i),this})),D(dt.prototype,"_regularize",(function(t){var e=this._opts.lambda;return e<=0||this._scale(X(1-t*e,1e-7)),this})),D(dt.prototype,"_scale",(function(t){var e;if(t<=0)throw new RangeError(Y("invalid argument. Attempting to scale a weight vector by a nonpositive value. This is likely due to too large a value of `eta*lambda`. Value: `%f`.",t));return(e=this._scaleFactor)<1e-11&&(U(this._N,e,this._weights,1),this._scaleFactor=1),this._scaleFactor*=t,this})),D(dt.prototype,"_squaredHingeLoss",(function(t,e){var i,r;return i=this[this._learningRateMethod](),this._regularize(i),(r=e*this._dot(t.data,t.strides[0],t.offset))<1&&this._add(t,i*(e-r*e)),this})),G(dt.prototype,"coefficients",(function(){var t=this._coefficients.data,e=this._weights;return Q(e.length,e,1,t,1),U(this._N,this._scaleFactor,t,1),this._coefficients})),G(dt.prototype,"nfeatures",(function(){return this._N})),D(dt.prototype,"predict",(function(t,e){var i,r,n,s,a,o,d,l,p,m,u,h,c,f,g,v;for(r=t.data,s=t.shape,p=t.strides,u=t.offset,o=t.order,i=s.length-1,a=[],v=0;v<i;v++)a.push(s[v]);for(0===i?(h=1,n=new et(1),m=[0]):(h=nt(a),n=new et(h),m=rt(a,o)),f=new it("int8",n,a,m,0,o),c=this._N,l=p[i],v=0;v<h;v++)d=st(s,p,u,o,v*c,"throw"),g=this._dot(r,l,d),"label"===e?g=g>0?1:-1:"probability"===e&&(g=tt(g)),0===i?f.iset(g):f.iset(v,g);return f})),D(dt.prototype,"update",(function(t,e){return this._t+=1,this[this._lossMethod](t,e)}));var lt=dt,pt={basic:["basic"],constant:["constant",.02],invscaling:["invscaling",.02,.5],pegasos:["pegasos"]},mt=y.isPrimitive,ut=w.isPrimitive,ht=_.isPrimitive,ct=E.isPrimitive,ft=x,gt=R,vt=T,bt=O,jt=s,yt=["basic","constant","invscaling","pegasos"],wt=["hinge","log","modifiedHuber","perceptron","squaredHinge"];var _t=function(t,e){var i;if(!gt(e))return new TypeError(jt("invalid argument. Options argument must be an object. Value: `%s`.",e));if(vt(e,"intercept")&&(t.intercept=e.intercept,!ct(t.intercept)))return new TypeError(jt("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",t.intercept));if(vt(e,"lambda")&&(t.lambda=e.lambda,!mt(t.lambda)))return new TypeError(jt("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",t.lambda));if(vt(e,"learningRate")){if(!ft(e.learningRate))return new TypeError(jt("invalid option. `%s` option must be an array-like object. Option: `%s`.","learningRate",e.learningRate));if(i=e.learningRate[0],t.learningRate[0]=i,!bt(yt,i))return new TypeError(jt('invalid option. First `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",yt.join('", "'),i));if(e.learningRate.length>1&&("constant"===i||"invscaling"===i)&&(t.learningRate[1]=e.learningRate[1],!ut(t.learningRate[1])))return new TypeError(jt("invalid option. Second `%s` option must be a positive number. Option: `%f`.","learningRate",t.learningRate[1]));if(e.learningRate.length>2&&"invscaling"===i&&(t.learningRate[2]=e.learningRate[2],!ht(t.learningRate[2])))return new TypeError(jt("invalid option. Third `%s` option must be a number. Option: `%f`.","learningRate",t.learningRate[2]))}return vt(e,"loss")&&(t.loss=e.loss,!bt(wt,t.loss))?new TypeError(jt('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",wt.join('", "'),t.loss)):null},Et=e.isPrimitive,xt=i,Rt=r,Tt=n,Ot=s,Vt=lt,zt=pt,kt=_t;var Ft=function(t,e){var i,r,n;if(!Et(t))throw new TypeError(Ot("invalid argument. First argument must be a positive integer. Value: `%s`.",t));if(r={intercept:!0,lambda:1e-4,learningRate:zt.basic.slice(),loss:"log"},arguments.length>1&&(n=kt(r,e)))throw n;return i=new Vt(t,r),Tt(s,"predict",a),s;function s(t,e){if(0===arguments.length)return i.coefficients;if(!xt(t))throw new TypeError(Ot("invalid argument. First argument must be a one-dimensional ndarray. Value: `%s`.",t));if(-1!==e&&1!==e)throw new TypeError(Ot("invalid argument. Second argument must be either +1 or -1. Value: `%s`.",e));if(t.shape[0]!==i.nfeatures)throw new TypeError(Ot("invalid argument. First argument must be a one-dimensional ndarray of length `%u`. Actual length: `%u`.",i.nfeatures,t.shape[0]));return i.update(t,e),i.coefficients}function a(e,n){var s,a;if(!Rt(e))throw new TypeError(Ot("invalid argument. First argument must be an ndarray. Value: `%s`.",e));if((s=e.shape)[s.length-1]!==t)throw new TypeError(Ot("invalid argument. First argument must be an ndarray whose last dimension is of size `%u`. Actual size: `%u`.",t,s[s.length-1]));if(a="label",arguments.length>1){if("probability"===n){if("log"!==r.loss&&"modifiedHuber"!==r.loss)throw new Error(Ot("invalid argument. Second argument is incompatible with model loss function. Probability predictions are only supported when the loss function is either `log` or `modifiedHuber`. Model loss function: `%s`.",r.loss))}else if("label"!==n&&"linear"!==n)throw new TypeError(Ot('invalid argument. Second argument must be a string value equal to either "label", "probability", or "linear". Value: `%s`.',n));a=n}return i.predict(e,a)}},Lt=Ft,Pt=f,At=g,Mt=L;var St=function(t,e,i){return(i?Mt:At)("float64",new Pt(t*e),[t,e],[e,1],0,"row-major")},qt=P.ndarray;var Ht=function(t,e){var i,r,n,s,a,o,d,l,p,m,u;for(p=e.shape[0],m=e.shape[1],i=e.data,r=t.data,n=e.strides[0],s=e.strides[1],a=t.strides[0],o=t.strides[1],d=e.offset,l=t.offset,u=0;u<p;u++)qt(m,i,s,d,r,o,l),d+=n,l+=a;return t},Nt=f,Wt=g,Bt=L;var It=function(t,e){return(e?Bt:Wt)("float64",new Nt(t),[t],[1],0,"row-major")},Ct=P.ndarray;var Dt=function(t,e){return Ct(e.shape[0],e.data,e.strides[0],e.offset,t.data,t.strides[0],t.offset),t},Gt=R,Yt=T,Jt=E.isPrimitive,Kt=x,Qt=e.isPrimitive,Ut=O,Xt=s,Zt=["euclidean","correlation","cosine"],$t=["forgy","sample","kmeans++"];var te=function(t,e){if(!Gt(e))return new TypeError(Xt("invalid argument. Options argument must be an object. Value: `%s`.",e));if(Yt(e,"metric")&&(t.metric=e.metric,!Ut(Zt,t.metric)))return new TypeError(Xt('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"metric",Zt.join('", "'),t.metric));if(Yt(e,"init")){if(!Kt(e.init))return new TypeError(Xt("invalid option. `%s` option must be an array-like object. Option: `%s`.","init",e.init));if(!Ut($t,e.init[0]))return new TypeError(Xt('invalid option. `%s` option method must be one of the following: "%s". Option: `%s`.',"init",$t.join('", "'),e.init[0]));if(t.init[0]=e.init[0],e.init.length>1&&(t.init[1]=e.init[1],!Qt(t.init[1])))return new TypeError(Xt("invalid option. First `init` parameter option must be a positive integer. Option: `%s`.",t.init[1]));if(e.init.length>2&&(t.init[2]=e.init[2],!Qt(t.init[2])))return new TypeError(Xt("invalid option. Second `init` parameter option must be a positive integer. Option: `%s`.",t.init[2]))}return Yt(e,"normalize")&&(t.normalize=e.normalize,!Jt(t.normalize))?new TypeError(Xt("invalid option. `%s` option must be a boolean. Option: `%s`.","normalize",t.normalize)):Yt(e,"copy")&&(t.copy=e.copy,!Jt(t.copy))?new TypeError(Xt("invalid option. `%s` option must be a boolean. Option: `%s`.","copy",t.copy)):(Yt(e,"seed")&&(t.seed=e.seed),null)},ee={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]},ie=A;var re=function(t,e,i,r){var n,s,a,o;for(s=0,n=r,o=0;o<t;o++)s+=(a=e[n])*a,n+=i;for(s=ie(s),n=r,o=0;o<t;o++)e[n]/=s;return e},ne=re;var se=function(t){var e,i,r,n,s,a,o;for(e=t.data,s=t.shape[0],a=t.shape[1],i=t.strides[0],r=t.strides[1],n=t.offset,o=0;o<s;o++)ne(a,e,r,n),n+=i;return t};var ae=function(t,e,i,r,n,s,a,o,d,l){var p,m,u,h;for(p=r,m=a,u=l,h=0;h<t;h++)e[p]=(e[p]-n[m])/o[u],p+=i,m+=s,u+=d;return e},oe=ae;var de=function(t,e){var i,r,n,s,a,o,d;for(i=t.data,a=t.shape[0],o=t.shape[1],r=t.strides[0],n=t.strides[1],s=t.offset,d=0;d<a;d++)oe(o,i,n,s,e,2,0,e,2,1),s+=r;return t},le=M.factory,pe=l.ndarray;var me=function(t,e,i){var r,n,s,a,o,d,l,p,m,u,h;for(m=t.shape[0],u=t.shape[1],n=t.data,d=t.strides[1],l=t.offset,s=e.data,a=e.strides[0],o=e.strides[1],r=[],h=0;h<e.shape[0];h++)r.push(h);for(p=m===r.length?r:le({seed:i,size:m,mutate:!1,replacement:!1})(r),h=0;h<m;h++)pe(u,s,o,a*p[h],n,d,l);return t},ue=A;var he=function(t,e,i,r,n,s,a){var o,d,l,p,m;for(o=r,d=a,p=0,m=0;m<t;m++)p+=(l=e[o]-n[d])*l,o+=i,d+=s;return ue(p)};var ce=function(t,e,i,r,n,s,a){var o=he(t,e,i,r,n,s,a);return o*o};var fe=function(t,e,i,r,n,s,a){var o,d,l,p;for(o=r,d=a,l=0,p=0;p<t;p++)l+=e[o]*n[d],o+=i,d+=s;return l},ge=fe;var ve=function(t,e,i,r,n,s,a){var o=1-ge(t,e,i,r,n,s,a);return o*o},be=fe;var je=function(t,e,i,r,n,s,a){var o=1-be(t,e,i,r,n,s,a);return o*o},ye=S.factory,we=q.factory,_e=H,Ee=l.ndarray,xe=ce,Re=ve,Te=je;function Oe(t,e,i,r,n,s){var a,o,d,l,p;for(l=n.data,a=(d=n.strides[0])*s,o=0,p=0;p<i;p++)t[p]=e(r,l,1,o,l,1,a),o+=d;return t}var Ve=function(t,e,i,r,n){var s,a,o,d,l,p,m,u,h,c,f,g,v,b,j,y,w,_,E,x,R,T,O,V,z,k,F,L;if(V=t.shape[0],d=t.shape[1],u=e.shape[0],g=t.data,w=t.strides[0],_=t.strides[1],E=t.offset,v=e.data,j=e.strides[0],y=e.strides[1],m=we({seed:n}),o=ye({seed:m()}),m=m.normalized,f="cosine"===i?Re:"correlation"===i?Te:xe,O=o(0,u-1),1===V)return Ee(d,v,y,j*O,g,_,E);for(s=[O],x=new Array(d),l=new Array(2*u),b=0,k=0;k<u;k++)l[b]=_e,l[b+1]=0,b+=2;for(p=new Array(u),F=1;F<V;F++){for(Oe(x,f,u,d,e,s[F-1]),h=0,b=0,k=0;k<u;k++)x[k]<l[b]?(l[b]=x[k],l[b+1]=F-1,h+=x[k]):h+=l[b],b+=2;for(p[0]=l[0]/h,b=2,k=1;k<u;k++)p[k]=p[k-1]+l[b]/h,b+=2;for(c=_e,R=-1,L=0;L<r;L++){for(O=-1;-1===O;)for(z=m(),k=0;k<u;k++)if(z<p[k]){O=k;break}for(h=0,a=j*O,b=0,k=0;k<u;k++)(T=f(d,v,1,j*k,v,1,a))<l[b]?h+=T:h+=l[b],b+=2;h<c&&(c=h,R=O)}s.push(R)}for(k=0;k<V;k++)Ee(d,v,y,j*s[k],g,_,E),E+=w;return t},ze=S.factory,ke=N;var Fe=function(t,e,i){var r,n,s,a,o,d,l,p,m,u,h,c,f,g,v,b;for(f=t.shape[0],g=t.shape[1],n=t.data,l=t.strides[0],p=t.strides[1],u=t.offset,a=e.data,s=e.shape[0],o=e.strides[0],d=e.strides[1],c=e.offset,r=ze(0,f-1,{seed:i}),m=[],v=0;v<f*g;v++)m.push(ke());for(v=0;v<s;v++){for(h=g*r(),b=0;b<g;b++)m[h+b](a[c+d*b]);c+=o}for(h=0,v=0;v<f;v++){for(b=0;b<g;b++)n[u+p*b]=m[h](),h+=1;u+=l}return t},Le=H;var Pe=function(t,e,i,r,n,s,a,o,d){var l,p,m,u;for(l=Le,u=0;u<e;u++)(m=t(i,r,1,s,a,o,d))<l&&(l=m,p=u),s+=n;return p};var Ae=function(t,e,i,r,n,s,a,o){var d,l;for(l=0;l<t;l++)d=i[n],d+=(s[o]-d)/e,i[n]=d,n+=r,o+=a;return i},Me=Pe,Se=Ae;var qe=function(t,e,i,r,n){var s,a,o,d,l,p,m,u,h,c,f,g;for(c=e.shape[0],s=e.shape[1],d=t.shape[0],a=e.data,l=e.strides[0],o=t.data,p=t.strides[0],u=0,g=0;g<d;g++)m=l*(f=Me(n,c,s,a,l,0,o,1,u)),h=i.get(f,0)+1,Se(s,h,a,1,m,o,1,u),r(f,n(s,a,1,m,o,1,u)),u+=p},He=P.ndarray,Ne=St,We=se,Be=de,Ie=me,Ce=Ve,De=Fe,Ge=qe;var Ye=function(t,e,i,r,n,s){var a,o;return o=t.shape[1],function(d){void 0===a&&((a=Ne(s.init[1],o,!0)).count=0);if(a.count<s.init[1]&&(He(o,d.data,d.strides[0],d.offset,a.data,a.strides[1],a.strides[0]*a.count),a.count+=1,a.count<s.init[1]))return!1;s.normalize&&("cosine"===s.metric?a=We(a):"correlation"===s.metric&&(a=Be(a,r())));t="forgy"===s.init[0]?De(t,a,s.seed):"sample"===s.init[0]?Ie(t,a,s.seed):Ce(t,a,s.metric,s.init[2],s.seed);return Ge(a,t,e,i,n),!0}},Je=A;var Ke=function(t,e){var i,r;for(i=[],r=0;r<e;r++)i.push(0);return function(e,r){var n,s,a;return a=t.get(e,0)+1,t.set(e,0,a),t.set(e,1,t.get(e,1)+r),s=t.get(e,2),s+=(n=r-s)/a,i[e]+=n*(r-s),t.set(e,2,s),t.set(e,3,Je(i[e]/(a-1))),t}},Qe=W,Ue=f;var Xe=function(t){var e,i,r,n,s;for(2,e=2*(r=new Ue(2*t)).BYTES_PER_ELEMENT,i=[],n=0,s=0;s<t;s++)i.push(Qe(new Ue(r.buffer,n,2))),n+=e;return function(e){var n;if(0===arguments.length)return r;for(n=0;n<t;n++)i[n](e.get(n));return r}},Ze=e.isPrimitive,$e=V,ti=i,ei=n,ii=s,ri=z,ni=k,si=F,ai=l,oi=St,di=Ht,li=It,pi=Dt,mi=te,ui=ee,hi=Ye,ci=Ke,fi=Xe,gi=ce,vi=ve,bi=je,ji=Pe,yi=Ae,wi=re,_i=se,Ei=ae,xi=de;function Ri(t,e){var i={};return i.centroids=oi(t,e,!1),i.stats=oi(t,4,!1),i}var Ti=function(){var t,e,i,r,n,s,a,o,d,l,p,m,u,h;if($e(arguments[0]))h=arguments[0].shape[0],o=arguments[0].shape[1],e=oi(h,o,!0),e=di(e,arguments[0]),arguments.length>1&&(r=arguments[1],u=!0);else{if(!Ze(arguments[0]))throw new TypeError(ii("invalid argument. First argument must either be a positive integer specifying the number of clusters or a matrix containing initial centroids. Value: `%s`.",arguments[0]));if(h=arguments[0],!Ze(o=arguments[1]))throw new TypeError(ii("invalid argument. Argument specifying number of dimensions must be a positive integer. Value: `%s`.",o));arguments.length>2&&(r=arguments[2],u=!0)}if((l={metric:"euclidean",init:ui["kmeans++"].slice(),seed:ri(),normalize:!0,copy:!0}).init[1]=h,l.init[2]=2+ni(si(h)),u&&(m=mi(l,r)))throw m;if(l.init[1]<h)throw new RangeError(ii("invalid option. First `init` parameter option must be greater than or equal to the number of clusters. Options: `%f`.",l.init[1]));return n=Ri(h,o),a=oi(h,4,!0),t=ci(a,h),"cosine"===l.metric?(d=vi,l.copy&&(s=li(o,!0))):"correlation"===l.metric?(d=bi,l.normalize&&(i=fi(o)),l.copy&&(s=li(o,!0))):d=gi,void 0===e?(e=oi(h,o,!0),p=hi(e,a,t,i,d,l)):di(n.centroids,e),ei(c,"seed",l.seed),ei(c,"predict",f),c;function c(r){var m,u,c,f,g,v,b,j,y,w,_;if(0===arguments.length)return p?null:n;if(!ti(j=r))throw new TypeError(ii("invalid argument. Must provide a 1-dimensional ndarray. Value: `%s`.",j));if(j.shape[0]!==o)throw new Error(ii("invalid argument. Vector length must match centroid dimensions. Expected: `%u``. Actual: `%u``.",o,j.shape[0]));if(i&&i(j),p){if(!1===p(j))return null;p=void 0}else l.normalize&&("cosine"===l.metric?(l.copy&&(j=pi(s,j)),wi(o,j.data,j.strides[0],j.offset)):"correlation"===l.metric&&(l.copy&&(j=pi(s,j)),c=i(),Ei(o,j.data,j.strides[0],j.offset,c,2,0,c,2,1))),m=e.data,g=e.strides[0],u=j.data,f=j.strides[0],v=j.offset,b=g*(_=ji(d,h,o,m,g,0,u,f,v)),y=a.get(_,0)+1,yi(o,y,m,1,b,u,f,v),w=d(o,m,1,b,u,f,v),t(_,w);return ai(e.length,e.data,1,n.centroids.data,1),ai(a.length,a.data,1,n.stats.data,1),n}function f(t,r){var n,s,a,m,u,c,f,g,v,b,j;if(arguments.length>1){if(!ti(t))throw new TypeError(ii("invalid argument. Output argument must be a 1-dimensional ndarray. Value: `%s`.",t));v=t,g=r}else g=t;if(!$e(g))throw new TypeError(ii("invalid argument. Must provide a 2-dimensional ndarray. Value: `%s`.",g));if(g.shape[1]!==o)throw new Error(ii("invalid argument. Number of matrix columns must match centroid dimensions. Expected: `%u``. Actual: `%u`.",o,g.shape[1]));if(void 0===v)v=li(g.shape[0],!1);else if(v.length!==g.shape[0])throw new Error(ii("invalid argument. Output vector length must match the number of data points. Expected: `%u`. Actual: `%u`.",g.shape[0],v.length));if(p)return null;for(a=g.shape[0],l.normalize&&("cosine"===l.metric?(l.copy&&(g=di(oi(a,o,!0),g)),g=_i(g)):"correlation"===l.metric&&(l.copy&&(g=di(oi(a,o,!0),g)),g=xi(g,i()))),s=e.data,c=e.strides[0],n=g.data,m=g.strides[0],u=g.strides[1],f=g.offset,j=0;j<a;j++)b=ji(d,h,o,s,c,0,n,u,f),v.set(j,b),f+=m;return v}},Oi=Ti;var Vi=e,zi=E,ki=n,Fi=s,Li=h,Pi=function(t,e){var i,r=t.length,n=0;for(i=0;i<r;i++)n+=t[i]*e[i];return n};function Ai(t,e){var i;if(!(this instanceof Ai))return new Ai(t,e);if(!Vi(t))throw new TypeError(Fi("invalid argument. First argument `dim` must be a positive integer. Value: `%s`.",t));if(!zi(e))throw new TypeError(Fi("invalid argument. Second argument `intercept` must be a boolean. Value: `%s`.",e));for(this.scale=1,this.norm=0,this.intercept=e,this.nWeights=t+(this.intercept?1:0),this._data=new Array(this.nWeights),i=0;i<this.nWeights;i++)this._data[i]=0}ki(Ai.prototype,"scaleTo",(function(t){var e;if(this.scale<1e-11){for(e=0;e<this.nWeights;e++)this._data[e]*=this.scale;this.scale=1}if(this.norm*=Li(t,2),!(t>0))throw new RangeError(Fi("Scaling weight vector by nonpositive value, likely due to too large value of eta * lambda. Value: `%f`.",t));this.scale*=t})),ki(Ai.prototype,"add",(function(t,e){var i,r,n;for(r=0,void 0===e&&(e=1),n=0;n<t.length;n++)i=t[n]*e,r+=this._data[n]*i,this._data[n]=this._data[n]+i/this.scale;this.intercept&&(i=1*e,r+=this._data[n]*i,this._data[n]=this._data[n]+i/this.scale),this.norm+=(Pi(t,t)+(this.intercept?1:0))*Li(e,2)+2*this.scale*r})),ki(Ai.prototype,"innerProduct",(function(t){var e,i=0;for(e=0;e<t.length;e++)i+=this._data[e]*t[e];return i+=this.intercept?this._data[e]:0,i*=this.scale}));var Mi=Ai,Si=m;var qi=function(t,e,i){var r;e>0&&(r=1-i*e,t.scaleTo(Si(r,1e-7)))},Hi=qi;var Ni=function(t,e,i,r,n,s){var a=t.innerProduct(e)-i;Hi(t,n,r),a>s?t.add(e,-r):a<-s&&t.add(e,+r)},Wi=qi;var Bi=function(t,e,i,r,n){var s=i-t.innerProduct(e);Wi(t,n,r),t.add(e,r*s)},Ii=qi;var Ci=function(t,e,i,r,n,s){var a=t.innerProduct(e)-i;Ii(t,n,r),a>s?t.add(e,-r):a<-s?t.add(e,+r):t.add(e,-r*a)},Di=s;var Gi=function(t,e,i){var r,n;switch(r=1,t){case"basic":n=function(){var t=1e3/(r+1e3);return r+=1,t};break;case"constant":n=function(){return r+=1,e};break;case"pegasos":n=function(){var t=1/(i*r);return r+=1,t};break;default:throw new Error(Di("invalid input value. `learningRate` must be either `basic`, `constant` or `pegasos`. Value: `%s`.",t))}return n},Yi={epsilon:.1,eta0:.02,intercept:!0,lambda:.001,learningRate:"basic",loss:"squaredError"},Ji=y.isPrimitive,Ki=w.isPrimitive,Qi=E.isPrimitive,Ui=R,Xi=C.isPrimitive,Zi=T,$i=s;var tr=B,er=s,ir=I,rr=a,nr=n,sr=Mi,ar=Ni,or=Bi,dr=Ci,lr=Gi,pr=Yi,mr=function(t,e){return Ui(e)?Zi(e,"epsilon")&&(t.epsilon=e.epsilon,!Ki(t.epsilon))?new TypeError($i("invalid option. `%s` option must be a positive number. Option: `%s`.","epsilon",t.epsilon)):Zi(e,"eta0")&&(t.eta0=e.eta0,!Ki(t.eta0))?new TypeError($i("invalid option. `%s` option must be a positive number. Option: `%s`.","eta0",t.eta0)):Zi(e,"lambda")&&(t.lambda=e.lambda,!Ji(t.lambda))?new TypeError($i("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",t.lambda)):Zi(e,"learningRate")&&(t.learningRate=e.learningRate,!Xi(t.learningRate))?new TypeError($i("invalid option. `%s` option must be a string. Option: `%s`.","learningRate",t.learningRate)):Zi(e,"loss")&&(t.loss=e.loss,!Xi(t.loss))?new TypeError($i("invalid option. `%s` option must be a string. Option: `%s`.","loss",t.loss)):Zi(e,"intercept")&&(t.intercept=e.intercept,!Qi(t.intercept))?new TypeError($i("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",t.intercept)):null:new TypeError($i("invalid argument. Options argument must be an object. Value: `%s`.",e))};var ur=function(t){var e,i,r,n,s,a,o;if(a=ir(pr),arguments.length>0&&(o=mr(a,t)))throw o;switch(r=null,a.loss){case"epsilonInsensitive":i=ar;break;case"huber":i=dr;break;case"squaredError":i=or;break;default:throw Error(er("invalid input value. `loss` option must be either `epsilonInsensitive`, `huber` or `squaredError`. Value: `%s`.",a.loss))}function s(t,s){var o;if(r||(r=new sr(t.length,a.intercept),e=a.intercept?r.nWeights-1:r.nWeights),!tr(t)||t.length!==e)throw new TypeError(er("invalid input value. First argument `x` must be an array of length `%u`. Value: `%u`",e,t));o=n(),i(r,t,s,o,a.lambda,a.epsilon)}return n=lr(a.learningRate,a.eta0,a.lambda),rr(s,"coefs",d),nr(s,"predict",l),s;function d(){var t,e;for(t=new Array(r.nWeights),e=0;e<t.length;e++)t[e]=r._data[e]*r.scale;return t}function l(t){if(!tr(t)||t.length!==e)throw new TypeError(er("invalid input value. First argument `x` must be an array of length %u. Value: `%s`",this.nFeatures,t));return r.innerProduct(t)}},hr=t,cr={};hr(cr,"incrBinaryClassification",Lt),hr(cr,"incrkmeans",Oi),hr(cr,"incrSGDRegression",ur);var fr=cr,gr={};t(gr,"incr",fr);var vr=gr;export{vr as default,fr as incr};
//# sourceMappingURL=index.mjs.map
