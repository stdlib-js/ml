// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.2.2-esm/index.mjs";import e,{isPrimitive as i}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-ndarray-like@v0.2.2-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.2.2-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import{ndarray as d}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gdot@esm/index.mjs";import{ndarray as l}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gaxpy@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dscal@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-exp@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-expit@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-shape2strides@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-vind2bind@esm/index.mjs";import{isPrimitive as w}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@v0.2.2-esm/index.mjs";import{isPrimitive as _}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@esm/index.mjs";import{isPrimitive as x}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-number@v0.2.2-esm/index.mjs";import E,{isPrimitive as R}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@v0.2.2-esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@v0.2.2-esm/index.mjs";import O from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import z from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import V from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import k from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@v0.2.2-esm/index.mjs";import F from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@v0.2.1-esm/index.mjs";import L from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@v0.2.3-esm/index.mjs";import P from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@v0.2.4-esm/index.mjs";import A,{ndarray as M}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@v0.3.0-esm/index.mjs";import S from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@v0.2.2-esm/index.mjs";import q from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@v0.2.2-esm/index.mjs";import H from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@v0.2.2-esm/index.mjs";import{ndarray as N}from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.2.1-esm/index.mjs";import W from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.2.2-esm/index.mjs";import B from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.2.2-esm/index.mjs";import I from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@v0.2.2-esm/index.mjs";import C from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@v0.2.2-esm/index.mjs";import{factory as D}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@esm/index.mjs";import{factory as G}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@esm/index.mjs";import{factory as Y}from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@esm/index.mjs";import J from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@v0.2.2-esm/index.mjs";import K from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@esm/index.mjs";import Q from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@v0.2.2-esm/index.mjs";import U from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array@v0.2.2-esm/index.mjs";import X from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@v0.2.2-esm/index.mjs";import Z from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@v0.3.0-esm/index.mjs";import{isPrimitive as $}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@v0.2.2-esm/index.mjs";import{isPrimitive as tt}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.2.2-esm/index.mjs";var et={basic:"_basicLearningRate",constant:"_constantLearningRate",invscaling:"_inverseScalingLearningRate",pegasos:"_pegasosLearningRate"},it={hinge:"_hingeLoss",log:"_logLoss",modifiedHuber:"_modifiedHuberLoss",perceptron:"_perceptronLoss",squaredHinge:"_squaredHingeLoss"};function st(t,e){var i;return this._N=t,this._opts=e,this._scaleFactor=1,this._t=0,this._learningRateMethod=et[e.learningRate[0]],this._lossMethod=it[e.loss],i=t,e.intercept&&(i+=1),this._weights=new g(i),this._coefficients=new v("float64",new g(i),[i],[1],0,"row-major"),this}r(st.prototype,"_add",(function(t,e){var i=e/this._scaleFactor,s=this._weights;return l(t.shape[0],i,t.data,t.strides[0],t.offset,s,1,0),this._opts.intercept&&(s[this._N]+=i),this})),r(st.prototype,"_basicLearningRate",(function(){return 10/(10+this._t)})),r(st.prototype,"_constantLearningRate",(function(){return this._opts.learningRate[1]})),r(st.prototype,"_dot",(function(t,e,i){var s=d(this._N,this._weights,1,0,t,e,i);return this._opts.intercept&&(s+=this._weights[this._N]),s*=this._scaleFactor})),r(st.prototype,"_hingeLoss",(function(t,e){var i;return i=this[this._learningRateMethod](),this._regularize(i),e*this._dot(t.data,t.strides[0],t.offset)<1&&this._add(t,e*i),this})),r(st.prototype,"_inverseScalingLearningRate",(function(){var t=this._opts.learningRate;return t[1]/c(this._t,t[2])})),r(st.prototype,"_logLoss",(function(t,e){var i,s,n;return s=this[this._learningRateMethod](),this._regularize(s),n=this._dot(t.data,t.strides[0],t.offset),i=e/(1+u(e*n)),this._add(t,s*i),this})),r(st.prototype,"_modifiedHuberLoss",(function(t,e){var i,s;return i=this[this._learningRateMethod](),this._regularize(i),(s=e*this._dot(t.data,t.strides[0],t.offset))<-1?this._add(t,4*i*e):this._add(t,i*(e-s*e)),this})),r(st.prototype,"_pegasosLearningRate",(function(){return 1/(this._opts.lambda*this._t)})),r(st.prototype,"_perceptronLoss",(function(t,e){var i;return i=this[this._learningRateMethod](),this._regularize(i),e*this._dot(t.data,t.strides[0],t.offset)<=0&&this._add(t,e*i),this})),r(st.prototype,"_regularize",(function(t){var e=this._opts.lambda;return e<=0||this._scale(h(1-t*e,1e-7)),this})),r(st.prototype,"_scale",(function(t){var e;if(t<=0)throw new RangeError(a("invalid argument. Attempting to scale a weight vector by a nonpositive value. This is likely due to too large a value of eta * lambda. Value: `%f`.",t));return(e=this._scaleFactor)<1e-11&&(m(this._N,e,this._weights,1),this._scaleFactor=1),this._scaleFactor*=t,this})),r(st.prototype,"_squaredHingeLoss",(function(t,e){var i,s;return i=this[this._learningRateMethod](),this._regularize(i),(s=e*this._dot(t.data,t.strides[0],t.offset))<1&&this._add(t,i*(e-s*e)),this})),o(st.prototype,"coefficients",(function(){var t=this._coefficients.data,e=this._weights;return p(e.length,e,1,t,1),m(this._N,this._scaleFactor,t,1),this._coefficients})),o(st.prototype,"nfeatures",(function(){return this._N})),r(st.prototype,"predict",(function(t,e){var i,s,n,r,a,o,d,l,p,m,h,u,c,w,_,x;for(s=t.data,r=t.shape,p=t.strides,h=t.offset,o=t.order,i=r.length-1,a=[],x=0;x<i;x++)a.push(r[x]);for(0===i?(u=1,n=new g(1),m=[0]):(u=j(a),n=new g(u),m=b(a,o)),w=new v("int8",n,a,m,0,o),c=this._N,l=p[i],x=0;x<u;x++)d=y(r,p,h,o,x*c,"throw"),_=this._dot(s,l,d),"label"===e?_=_>0?1:-1:"probability"===e&&(_=f(_)),0===i?w.iset(_):w.iset(x,_);return w})),r(st.prototype,"update",(function(t,e){return this._t+=1,this[this._lossMethod](t,e)}));var nt={basic:["basic"],constant:["constant",.02],invscaling:["invscaling",.02,.5],pegasos:["pegasos"]},rt=["basic","constant","invscaling","pegasos"],at=["hinge","log","modifiedHuber","perceptron","squaredHinge"];function ot(t,e,i){return(i?H:q)("float64",new S(t*e),[t,e],[e,1],0,"row-major")}function dt(t,e){var i,s,n,r,a,o,d,l,p,m,h;for(p=e.shape[0],m=e.shape[1],i=e.data,s=t.data,n=e.strides[0],r=e.strides[1],a=t.strides[0],o=t.strides[1],d=e.offset,l=t.offset,h=0;h<p;h++)N(m,i,r,d,s,o,l),d+=n,l+=a;return t}function lt(t,e){return(e?H:q)("float64",new S(t),[t],[1],0,"row-major")}function pt(t,e){return N(e.shape[0],e.data,e.strides[0],e.offset,t.data,t.strides[0],t.offset),t}var mt=["euclidean","correlation","cosine"],ht=["forgy","sample","kmeans++"];var ut={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]};function ct(t,e,i,s){var n,r,a,o;for(r=0,n=s,o=0;o<t;o++)r+=(a=e[n])*a,n+=i;for(r=C(r),n=s,o=0;o<t;o++)e[n]/=r;return e}function ft(t){var e,i,s,n,r,a,o;for(e=t.data,r=t.shape[0],a=t.shape[1],i=t.strides[0],s=t.strides[1],n=t.offset,o=0;o<r;o++)ct(a,e,s,n),n+=i;return t}function gt(t,e,i,s,n,r,a,o,d,l){var p,m,h,u;for(p=s,m=a,h=l,u=0;u<t;u++)e[p]=(e[p]-n[m])/o[h],p+=i,m+=r,h+=d;return e}function vt(t,e){var i,s,n,r,a,o,d;for(i=t.data,a=t.shape[0],o=t.shape[1],s=t.strides[0],n=t.strides[1],r=t.offset,d=0;d<a;d++)gt(o,i,n,r,e,2,0,e,2,1),r+=s;return t}function bt(t,e,i,s,n,r,a){var o=function(t,e,i,s,n,r,a){var o,d,l,p,m;for(o=s,d=a,p=0,m=0;m<t;m++)p+=(l=e[o]-n[d])*l,o+=i,d+=r;return C(p)}(t,e,i,s,n,r,a);return o*o}function jt(t,e,i,s,n,r,a){var o,d,l,p;for(o=s,d=a,l=0,p=0;p<t;p++)l+=e[o]*n[d],o+=i,d+=r;return l}function yt(t,e,i,s,n,r,a){var o=1-jt(t,e,i,s,n,r,a);return o*o}function wt(t,e,i,s,n,r,a){var o=1-jt(t,e,i,s,n,r,a);return o*o}function _t(t,e,i,s,n,r){var a,o,d,l,p;for(l=n.data,a=(d=n.strides[0])*r,o=0,p=0;p<i;p++)t[p]=e(s,l,1,o,l,1,a),o+=d;return t}function xt(t,e,i,s,n,r,a,o,d){var l,p,m,h;for(l=J,h=0;h<e;h++)(m=t(i,s,1,r,a,o,d))<l&&(l=m,p=h),r+=n;return p}function Et(t,e,i,s,n,r,a,o){var d,l;for(l=0;l<t;l++)d=i[n],d+=(r[o]-d)/e,i[n]=d,n+=s,o+=a;return i}function Rt(t,e,i,s,n,r){var a,o;return o=t.shape[1],function(d){void 0===a&&((a=ot(r.init[1],o,!0)).count=0);if(a.count<r.init[1]&&(N(o,d.data,d.strides[0],d.offset,a.data,a.strides[1],a.strides[0]*a.count),a.count+=1,a.count<r.init[1]))return!1;r.normalize&&("cosine"===r.metric?a=ft(a):"correlation"===r.metric&&(a=vt(a,s())));t="forgy"===r.init[0]?function(t,e,i){var s,n,r,a,o,d,l,p,m,h,u,c,f,g,v,b;for(f=t.shape[0],g=t.shape[1],n=t.data,l=t.strides[0],p=t.strides[1],h=t.offset,a=e.data,r=e.shape[0],o=e.strides[0],d=e.strides[1],c=e.offset,s=G(0,f-1,{seed:i}),m=[],v=0;v<f*g;v++)m.push(K());for(v=0;v<r;v++){for(u=g*s(),b=0;b<g;b++)m[u+b](a[c+d*b]);c+=o}for(u=0,v=0;v<f;v++){for(b=0;b<g;b++)n[h+p*b]=m[u](),u+=1;h+=l}return t}(t,a,r.seed):"sample"===r.init[0]?function(t,e,i){var s,n,r,a,o,d,l,p,m,h,u;for(m=t.shape[0],h=t.shape[1],n=t.data,d=t.strides[1],l=t.offset,r=e.data,a=e.strides[0],o=e.strides[1],s=[],u=0;u<e.shape[0];u++)s.push(u);for(p=m===s.length?s:D({seed:i,size:m,mutate:!1,replacement:!1})(s),u=0;u<m;u++)M(h,r,o,a*p[u],n,d,l);return t}(t,a,r.seed):function(t,e,i,s,n){var r,a,o,d,l,p,m,h,u,c,f,g,v,b,j,y,w,_,x,E,R,T,O,z,V,k,F,L;if(z=t.shape[0],d=t.shape[1],h=e.shape[0],g=t.data,w=t.strides[0],_=t.strides[1],x=t.offset,v=e.data,j=e.strides[0],y=e.strides[1],m=Y({seed:n}),o=G({seed:m()}),m=m.normalized,f="cosine"===i?yt:"correlation"===i?wt:bt,O=o(0,h-1),1===z)return M(d,v,y,j*O,g,_,x);for(r=[O],E=new Array(d),l=new Array(2*h),b=0,k=0;k<h;k++)l[b]=J,l[b+1]=0,b+=2;for(p=new Array(h),F=1;F<z;F++){for(_t(E,f,h,d,e,r[F-1]),u=0,b=0,k=0;k<h;k++)E[k]<l[b]?(l[b]=E[k],l[b+1]=F-1,u+=E[k]):u+=l[b],b+=2;for(p[0]=l[0]/u,b=2,k=1;k<h;k++)p[k]=p[k-1]+l[b]/u,b+=2;for(c=J,R=-1,L=0;L<s;L++){for(O=-1;-1===O;)for(V=m(),k=0;k<h;k++)if(V<p[k]){O=k;break}for(u=0,a=j*O,b=0,k=0;k<h;k++)(T=f(d,v,1,j*k,v,1,a))<l[b]?u+=T:u+=l[b],b+=2;u<c&&(c=u,R=O)}r.push(R)}for(k=0;k<z;k++)M(d,v,y,j*r[k],g,_,x),x+=w;return t}(t,a,r.metric,r.init[2],r.seed);return function(t,e,i,s,n){var r,a,o,d,l,p,m,h,u,c,f;for(u=e.shape[0],r=e.shape[1],d=t.shape[0],a=e.data,l=e.strides[0],o=t.data,p=t.strides[0],h=0,f=0;f<d;f++)m=l*(c=xt(n,u,r,a,l,0,o,1,h)),Et(r,i.get(c,0)+1,a,1,m,o,1,h),s(c,n(r,a,1,m,o,1,h)),h+=p}(a,t,e,i,n),!0}}var Tt=4;function Ot(t,i){var s;if(!(this instanceof Ot))return new Ot(t,i);if(!e(t))throw new TypeError(a("invalid argument. First argument must be a positive integer. Value: `%s`.",t));if(!E(i))throw new TypeError(a("invalid argument. Second argument must be a boolean. Value: `%s`.",i));for(this.scale=1,this.norm=0,this.intercept=i,this.nWeights=t+(this.intercept?1:0),this._data=new Array(this.nWeights),s=0;s<this.nWeights;s++)this._data[s]=0}r(Ot.prototype,"scaleTo",(function(t){var e;if(this.scale<1e-11){for(e=0;e<this.nWeights;e++)this._data[e]*=this.scale;this.scale=1}if(this.norm*=Z(t,2),!(t>0))throw new RangeError(a("unexpected error. Scaling weight vector by nonpositive value, likely due to too large value of eta * lambda. Value: `%f`.",t));this.scale*=t})),r(Ot.prototype,"add",(function(t,e){var i,s,n;for(s=0,void 0===e&&(e=1),n=0;n<t.length;n++)i=t[n]*e,s+=this._data[n]*i,this._data[n]=this._data[n]+i/this.scale;this.intercept&&(i=1*e,s+=this._data[n]*i,this._data[n]=this._data[n]+i/this.scale),this.norm+=(function(t,e){var i,s=t.length,n=0;for(i=0;i<s;i++)n+=t[i]*e[i];return n}(t,t)+(this.intercept?1:0))*Z(e,2)+2*this.scale*s})),r(Ot.prototype,"innerProduct",(function(t){var e,i=0;for(e=0;e<t.length;e++)i+=this._data[e]*t[e];return i+=this.intercept?this._data[e]:0,i*=this.scale}));var zt=1e-7;function Vt(t,e,i){var s;e>0&&(s=1-i*e,t.scaleTo(h(s,zt)))}function kt(t,e,i,s,n,r){var a=t.innerProduct(e)-i;Vt(t,n,s),a>r?t.add(e,-s):a<-r&&t.add(e,+s)}function Ft(t,e,i,s,n){var r=i-t.innerProduct(e);Vt(t,n,s),t.add(e,s*r)}function Lt(t,e,i,s,n,r){var a=t.innerProduct(e)-i;Vt(t,n,s),a>r?t.add(e,-s):a<-r?t.add(e,+s):t.add(e,-s*a)}var Pt={epsilon:.1,eta0:.02,intercept:!0,lambda:.001,learningRate:"basic",loss:"squaredError"};var At={};t(At,"incrBinaryClassification",(function(t,e){var o,d,l;if(!i(t))throw new TypeError(a("invalid argument. First argument must be a positive integer. Value: `%s`.",t));if(d={intercept:!0,lambda:1e-4,learningRate:nt.basic.slice(),loss:"log"},arguments.length>1&&(l=function(t,e){var i;if(!O(e))return new TypeError(a("invalid argument. Options argument must be an object. Value: `%s`.",e));if(z(e,"intercept")&&(t.intercept=e.intercept,!R(t.intercept)))return new TypeError(a("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",t.intercept));if(z(e,"lambda")&&(t.lambda=e.lambda,!w(t.lambda)))return new TypeError(a("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",t.lambda));if(z(e,"learningRate")){if(!T(e.learningRate))return new TypeError(a("invalid option. `%s` option must be an array-like object. Option: `%s`.","learningRate",e.learningRate));if(i=e.learningRate[0],t.learningRate[0]=i,!V(rt,i))return new TypeError(a('invalid option. First `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",rt.join('", "'),i));if(e.learningRate.length>1&&("constant"===i||"invscaling"===i)&&(t.learningRate[1]=e.learningRate[1],!_(t.learningRate[1])))return new TypeError(a("invalid option. Second `%s` option must be a positive number. Option: `%s`.","learningRate",t.learningRate[1]));if(e.learningRate.length>2&&"invscaling"===i&&(t.learningRate[2]=e.learningRate[2],!x(t.learningRate[2])))return new TypeError(a("invalid option. Third `%s` option must be a number. Option: `%s`.","learningRate",t.learningRate[2]))}return z(e,"loss")&&(t.loss=e.loss,!V(at,t.loss))?new TypeError(a('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",at.join('", "'),t.loss)):null}(d,e)))throw l;return o=new st(t,d),r(p,"predict",(function(e,i){var s,r;if(!n(e))throw new TypeError(a("invalid argument. First argument must be an ndarray. Value: `%s`.",e));if((s=e.shape)[s.length-1]!==t)throw new TypeError(a("invalid argument. First argument must be an ndarray whose last dimension is of size %u. Actual size: `%u`.",t,s[s.length-1]));if(r="label",arguments.length>1){if("probability"===i){if("log"!==d.loss&&"modifiedHuber"!==d.loss)throw new Error(a('invalid argument. Second argument is incompatible with model loss function. Probability predictions are only supported when the loss function is one of the following: "%s". Model loss function: `%s`.',["log","modifiedHuber"].join('", "'),d.loss))}else if("label"!==i&&"linear"!==i)throw new TypeError(a('invalid argument. Second argument must be a string value equal to either "label", "probability", or "linear". Value: `%s`.',i));r=i}return o.predict(e,r)})),p;function p(t,e){if(0===arguments.length)return o.coefficients;if(!s(t))throw new TypeError(a("invalid argument. First argument must be a one-dimensional ndarray. Value: `%s`.",t));if(-1!==e&&1!==e)throw new TypeError(a("invalid argument. Second argument must be either +1 or -1. Value: `%s`.",e));if(t.shape[0]!==o.nfeatures)throw new TypeError(a("invalid argument. First argument must be a one-dimensional ndarray of length %u. Actual length: `%u`.",o.nfeatures,t.shape[0]));return o.update(t,e),o.coefficients}})),t(At,"incrkmeans",(function(){var t,e,n,o,d,l,p,m,h,u,c,f,g,v;if(k(arguments[0]))v=arguments[0].shape[0],m=arguments[0].shape[1],e=dt(e=ot(v,m,!0),arguments[0]),arguments.length>1&&(o=arguments[1],g=!0);else{if(!i(arguments[0]))throw new TypeError(a("invalid argument. First argument must either be a positive integer specifying the number of clusters or a matrix containing initial centroids. Value: `%s`.",arguments[0]));if(v=arguments[0],!i(m=arguments[1]))throw new TypeError(a("invalid argument. Argument specifying number of dimensions must be a positive integer. Value: `%s`.",m));arguments.length>2&&(o=arguments[2],g=!0)}if((u={metric:"euclidean",init:ut["kmeans++"].slice(),seed:F(),normalize:!0,copy:!0}).init[1]=v,u.init[2]=2+L(P(v)),g&&(f=function(t,e){if(!W(e))return new TypeError(a("invalid argument. Options argument must be an object. Value: `%s`.",e));if(B(e,"metric")&&(t.metric=e.metric,!I(mt,t.metric)))return new TypeError(a('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"metric",mt.join('", "'),t.metric));if(B(e,"init")){if(!T(e.init))return new TypeError(a("invalid option. `%s` option must be an array-like object. Option: `%s`.","init",e.init));if(!I(ht,e.init[0]))return new TypeError(a('invalid option. `%s` option method must be one of the following: "%s". Option: `%s`.',"init",ht.join('", "'),e.init[0]));if(t.init[0]=e.init[0],e.init.length>1&&(t.init[1]=e.init[1],!i(t.init[1])))return new TypeError(a("invalid option. First `%s` parameter option must be a positive integer. Option: `%s`.","init",t.init[1]));if(e.init.length>2&&(t.init[2]=e.init[2],!i(t.init[2])))return new TypeError(a("invalid option. Second `%s` parameter option must be a positive integer. Option: `%s`.","init",t.init[2]))}return B(e,"normalize")&&(t.normalize=e.normalize,!R(t.normalize))?new TypeError(a("invalid option. `%s` option must be a boolean. Option: `%s`.","normalize",t.normalize)):B(e,"copy")&&(t.copy=e.copy,!R(t.copy))?new TypeError(a("invalid option. `%s` option must be a boolean. Option: `%s`.","copy",t.copy)):(B(e,"seed")&&(t.seed=e.seed),null)}(u,o)))throw f;if(u.init[1]<v)throw new RangeError(a("invalid option. First `%s` parameter option must be greater than or equal to the number of clusters. Options: `%f`.","init",u.init[1]));return d=function(t,e){var i={};return i.centroids=ot(t,e,!1),i.stats=ot(t,Tt,!1),i}(v,m),p=ot(v,Tt,!0),t=function(t,e){var i,s;for(i=[],s=0;s<e;s++)i.push(0);return function(e,s){var n,r,a;return a=t.get(e,0)+1,t.set(e,0,a),t.set(e,1,t.get(e,1)+s),r=t.get(e,2),r+=(n=s-r)/a,i[e]+=n*(s-r),t.set(e,2,r),t.set(e,3,C(i[e]/(a-1))),t}}(p,v),"cosine"===u.metric?(h=yt,u.copy&&(l=lt(m,!0))):"correlation"===u.metric?(h=wt,u.normalize&&(n=function(t){var e,i,s,n,r;for(e=2*(s=new S(2*t)).BYTES_PER_ELEMENT,i=[],n=0,r=0;r<t;r++)i.push(Q(new S(s.buffer,n,2))),n+=e;return function(e){var n;if(0===arguments.length)return s;for(n=0;n<t;n++)i[n](e.get(n));return s}}(m)),u.copy&&(l=lt(m,!0))):h=bt,void 0===e?(e=ot(v,m,!0),c=Rt(e,p,t,n,h,u)):dt(d.centroids,e),r(b,"seed",u.seed),r(b,"predict",(function(t,i){var r,o,d,l,p,f,g,b,j,y,w;if(arguments.length>1){if(!s(t))throw new TypeError(a("invalid argument. Output argument must be a one-dimensional ndarray. Value: `%s`.",t));j=t,b=i}else b=t;if(!k(b))throw new TypeError(a("invalid argument. Must provide a two-dimensional ndarray. Value: `%s`.",b));if(b.shape[1]!==m)throw new Error(a("invalid argument. Number of matrix columns must match centroid dimensions. Expected: `%u`. Actual: `%u`.",m,b.shape[1]));if(void 0===j)j=lt(b.shape[0],!1);else if(j.length!==b.shape[0])throw new Error(a("invalid argument. Output vector length must match the number of data points. Expected: `%u`. Actual: `%u`.",b.shape[0],j.length));if(c)return null;d=b.shape[0],u.normalize&&("cosine"===u.metric?(u.copy&&(b=dt(ot(d,m,!0),b)),b=ft(b)):"correlation"===u.metric&&(u.copy&&(b=dt(ot(d,m,!0),b)),b=vt(b,n())));for(o=e.data,f=e.strides[0],r=b.data,l=b.strides[0],p=b.strides[1],g=b.offset,w=0;w<d;w++)y=xt(h,v,m,o,f,0,r,p,g),j.set(w,y),g+=l;return j})),b;function b(i){var r,o,f,g,b,j,y,w,_,x,E;if(0===arguments.length)return c?null:d;if(!s(w=i))throw new TypeError(a("invalid argument. Must provide a one-dimensional ndarray. Value: `%s`.",w));if(w.shape[0]!==m)throw new Error(a("invalid argument. Vector length must match centroid dimensions. Expected: `%u``. Actual: `%u``.",m,w.shape[0]));if(n&&n(w),c){if(!1===c(w))return null;c=void 0}else u.normalize&&("cosine"===u.metric?(u.copy&&(w=pt(l,w)),ct(m,w.data,w.strides[0],w.offset)):"correlation"===u.metric&&(u.copy&&(w=pt(l,w)),f=n(),gt(m,w.data,w.strides[0],w.offset,f,2,0,f,2,1))),r=e.data,b=e.strides[0],o=w.data,g=w.strides[0],j=w.offset,y=b*(E=xt(h,v,m,r,b,0,o,g,j)),_=p.get(E,0)+1,Et(m,_,r,1,y,o,g,j),x=h(m,r,1,y,o,g,j),t(E,x);return A(e.length,e.data,1,d.centroids.data,1),A(p.length,p.data,1,d.stats.data,1),d}})),t(At,"incrSGDRegression",(function(t){var e,i,s,n,d,l,p;if(l=X(Pt),arguments.length>0&&(p=function(t,e){return W(e)?B(e,"epsilon")&&(t.epsilon=e.epsilon,!$(t.epsilon))?new TypeError(a("invalid option. `%s` option must be a positive number. Option: `%s`.","epsilon",t.epsilon)):B(e,"eta0")&&(t.eta0=e.eta0,!$(t.eta0))?new TypeError(a("invalid option. `%s` option must be a positive number. Option: `%s`.","eta0",t.eta0)):B(e,"lambda")&&(t.lambda=e.lambda,!w(t.lambda))?new TypeError(a("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",t.lambda)):B(e,"learningRate")&&(t.learningRate=e.learningRate,!tt(t.learningRate))?new TypeError(a("invalid option. `%s` option must be a string. Option: `%s`.","learningRate",t.learningRate)):B(e,"loss")&&(t.loss=e.loss,!tt(t.loss))?new TypeError(a("invalid option. `%s` option must be a string. Option: `%s`.","loss",t.loss)):B(e,"intercept")&&(t.intercept=e.intercept,!R(t.intercept))?new TypeError(a("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",t.intercept)):null:new TypeError(a("invalid argument. Options argument must be an object. Value: `%s`.",e))}(l,t)))throw p;switch(s=null,l.loss){case"epsilonInsensitive":i=kt;break;case"huber":i=Lt;break;case"squaredError":i=Ft;break;default:throw Error(a('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",["epsilonInsensitive","huber","squaredError"].join('", "'),l.loss))}function d(t,r){var o;if(!U(t))throw new TypeError(a("invalid argument. First argument must be an array. Value: `%s`.",t));if(s||(s=new Ot(t.length,l.intercept),e=l.intercept?s.nWeights-1:s.nWeights),t.length!==e)throw new TypeError(a("invalid argument. First argument must be an array of length %u. Value: `%s`.",e,t));o=n(),i(s,t,r,o,l.lambda,l.epsilon)}return n=function(t,e,i){var s,n;switch(s=1,t){case"basic":n=function(){var t=1e3/(s+1e3);return s+=1,t};break;case"constant":n=function(){return s+=1,e};break;case"pegasos":n=function(){var t=1/(i*s);return s+=1,t};break;default:throw new Error(a('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",["basic","constant","pegasos"].join('", "'),t))}return n}(l.learningRate,l.eta0,l.lambda),o(d,"coefs",(function(){var t,e;for(t=new Array(s.nWeights),e=0;e<t.length;e++)t[e]=s._data[e]*s.scale;return t})),r(d,"predict",(function(t){if(!U(t)||t.length!==e)throw new TypeError(a("invalid argument. First argument must be an array of length %u. Value: `%s`.",e||0,t));return s.innerProduct(t)})),d}));var Mt={};t(Mt,"incr",At);export{Mt as default,At as incr};
//# sourceMappingURL=index.mjs.map
