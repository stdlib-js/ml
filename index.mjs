// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-ndarray-like@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.0.3-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gdot@v0.0.8-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gaxpy@v0.0.8-esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dcopy@v0.0.10-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-dscal@v0.0.10-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-max@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-exp@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-expit@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-shape2strides@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-vind2bind@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-number@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@esm/index.mjs";import _ from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-number@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-boolean@esm/index.mjs";import x from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array-like-object@esm/index.mjs";import R from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import O from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import z from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-matrix-like@esm/index.mjs";import V from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-minstd-shuffle@esm/index.mjs";import k from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@esm/index.mjs";import F from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ln@esm/index.mjs";import L from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@esm/index.mjs";import P from"https://cdn.jsdelivr.net/gh/stdlib-js/blas-base-gcopy@v0.0.8-esm/index.mjs";import A from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@esm/index.mjs";import M from"https://cdn.jsdelivr.net/gh/stdlib-js/random-sample@esm/index.mjs";import S from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-discrete-uniform@esm/index.mjs";import q from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-mt19937@esm/index.mjs";import H from"https://cdn.jsdelivr.net/gh/stdlib-js/constants-float64-pinf@v0.0.8-esm/index.mjs";import N from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-mean@esm/index.mjs";import W from"https://cdn.jsdelivr.net/gh/stdlib-js/stats-incr-meanstdev@esm/index.mjs";import B from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-array@esm/index.mjs";import I from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import C from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";var D,G;var Y,J,K,Q,U,X,Z,$,tt,et,rt,nt,it,st,at={basic:["basic"],constant:["constant",.02],invscaling:["invscaling",.02,.5],pegasos:["pegasos"]},ot=["basic","constant","invscaling","pegasos"],dt=["hinge","log","modifiedHuber","perceptron","squaredHinge"];function ut(){if(Q)return K;Q=1;var t=e.isPrimitive,z=r,V=n,k=i,F=s,L=function(){if(G)return D;G=1;var t=i,e=a,r=s,n=o.ndarray,y=d.ndarray,w=u,_=l,E=p,x=f,R=m,T=c,O=h,z=g,V=v,k=b,F=j,L={basic:"_basicLearningRate",constant:"_constantLearningRate",invscaling:"_inverseScalingLearningRate",pegasos:"_pegasosLearningRate"},P={hinge:"_hingeLoss",log:"_logLoss",modifiedHuber:"_modifiedHuberLoss",perceptron:"_perceptronLoss",squaredHinge:"_squaredHingeLoss"};function A(t,e){var r;return this._N=t,this._opts=e,this._scaleFactor=1,this._t=0,this._learningRateMethod=L[e.learningRate[0]],this._lossMethod=P[e.loss],r=t,e.intercept&&(r+=1),this._weights=new O(r),this._coefficients=new z("float64",new O(r),[r],[1],0,"row-major"),this}return t(A.prototype,"_add",(function(t,e){var r=e/this._scaleFactor,n=this._weights;return y(t.shape[0],r,t.data,t.strides[0],t.offset,n,1,0),this._opts.intercept&&(n[this._N]+=r),this})),t(A.prototype,"_basicLearningRate",(function(){return 10/(10+this._t)})),t(A.prototype,"_constantLearningRate",(function(){return this._opts.learningRate[1]})),t(A.prototype,"_dot",(function(t,e,r){var i=n(this._N,this._weights,1,0,t,e,r);return this._opts.intercept&&(i+=this._weights[this._N]),i*this._scaleFactor})),t(A.prototype,"_hingeLoss",(function(t,e){var r;return r=this[this._learningRateMethod](),this._regularize(r),e*this._dot(t.data,t.strides[0],t.offset)<1&&this._add(t,e*r),this})),t(A.prototype,"_inverseScalingLearningRate",(function(){var t=this._opts.learningRate;return t[1]/R(this._t,t[2])})),t(A.prototype,"_logLoss",(function(t,e){var r,n,i;return n=this[this._learningRateMethod](),this._regularize(n),i=this._dot(t.data,t.strides[0],t.offset),r=e/(1+x(e*i)),this._add(t,n*r),this})),t(A.prototype,"_modifiedHuberLoss",(function(t,e){var r,n;return r=this[this._learningRateMethod](),this._regularize(r),(n=e*this._dot(t.data,t.strides[0],t.offset))<-1?this._add(t,4*r*e):this._add(t,r*(e-n*e)),this})),t(A.prototype,"_pegasosLearningRate",(function(){return 1/(this._opts.lambda*this._t)})),t(A.prototype,"_perceptronLoss",(function(t,e){var r;return r=this[this._learningRateMethod](),this._regularize(r),e*this._dot(t.data,t.strides[0],t.offset)<=0&&this._add(t,e*r),this})),t(A.prototype,"_regularize",(function(t){var e=this._opts.lambda;return e<=0||this._scale(E(1-t*e,1e-7)),this})),t(A.prototype,"_scale",(function(t){var e;if(t<=0)throw new RangeError(r("invalid argument. Attempting to scale a weight vector by a nonpositive value. This is likely due to too large a value of eta * lambda. Value: `%f`.",t));return(e=this._scaleFactor)<1e-11&&(_(this._N,e,this._weights,1),this._scaleFactor=1),this._scaleFactor*=t,this})),t(A.prototype,"_squaredHingeLoss",(function(t,e){var r,n;return r=this[this._learningRateMethod](),this._regularize(r),(n=e*this._dot(t.data,t.strides[0],t.offset))<1&&this._add(t,r*(e-n*e)),this})),e(A.prototype,"coefficients",(function(){var t=this._coefficients.data,e=this._weights;return w(e.length,e,1,t,1),_(this._N,this._scaleFactor,t,1),this._coefficients})),e(A.prototype,"nfeatures",(function(){return this._N})),t(A.prototype,"predict",(function(t,e){var r,n,i,s,a,o,d,u,l,p,f,m,c,h,g,v;for(n=t.data,s=t.shape,l=t.strides,f=t.offset,o=t.order,r=s.length-1,a=[],v=0;v<r;v++)a.push(s[v]);for(0===r?(m=1,i=new O(1),p=[0]):(m=k(a),i=new O(m),p=V(a,o)),h=new z("int8",i,a,p,0,o),c=this._N,u=l[r],v=0;v<m;v++)d=F(s,l,f,o,v*c,"throw"),g=this._dot(n,u,d),"label"===e?g=g>0?1:-1:"probability"===e&&(g=T(g)),0===r?h.iset(g):h.iset(v,g);return h})),t(A.prototype,"update",(function(t,e){return this._t+=1,this[this._lossMethod](t,e)})),D=A}(),P=at,A=function(){if(J)return Y;J=1;var t=y.isPrimitive,e=w.isPrimitive,r=_.isPrimitive,n=E.isPrimitive,i=x,a=R,o=T,d=O,u=s,l=ot,p=dt;return Y=function(s,f){var m;if(!a(f))return new TypeError(u("invalid argument. Options argument must be an object. Value: `%s`.",f));if(o(f,"intercept")&&(s.intercept=f.intercept,!n(s.intercept)))return new TypeError(u("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",s.intercept));if(o(f,"lambda")&&(s.lambda=f.lambda,!t(s.lambda)))return new TypeError(u("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",s.lambda));if(o(f,"learningRate")){if(!i(f.learningRate))return new TypeError(u("invalid option. `%s` option must be an array-like object. Option: `%s`.","learningRate",f.learningRate));if(m=f.learningRate[0],s.learningRate[0]=m,!d(l,m))return new TypeError(u('invalid option. First `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",l.join('", "'),m));if(f.learningRate.length>1&&("constant"===m||"invscaling"===m)&&(s.learningRate[1]=f.learningRate[1],!e(s.learningRate[1])))return new TypeError(u("invalid option. Second `%s` option must be a positive number. Option: `%s`.","learningRate",s.learningRate[1]));if(f.learningRate.length>2&&"invscaling"===m&&(s.learningRate[2]=f.learningRate[2],!r(s.learningRate[2])))return new TypeError(u("invalid option. Third `%s` option must be a number. Option: `%s`.","learningRate",s.learningRate[2]))}return o(f,"loss")&&(s.loss=f.loss,!d(p,s.loss))?new TypeError(u('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",p.join('", "'),s.loss)):null}}();return K=function(e,r){var n,i,s;if(!t(e))throw new TypeError(F("invalid argument. First argument must be a positive integer. Value: `%s`.",e));if(i={intercept:!0,lambda:1e-4,learningRate:P.basic.slice(),loss:"log"},arguments.length>1&&(s=A(i,r)))throw s;return n=new L(e,i),k(a,"predict",o),a;function a(t,e){if(0===arguments.length)return n.coefficients;if(!z(t))throw new TypeError(F("invalid argument. First argument must be a one-dimensional ndarray. Value: `%s`.",t));if(-1!==e&&1!==e)throw new TypeError(F("invalid argument. Second argument must be either +1 or -1. Value: `%s`.",e));if(t.shape[0]!==n.nfeatures)throw new TypeError(F("invalid argument. First argument must be a one-dimensional ndarray of length %u. Actual length: `%u`.",n.nfeatures,t.shape[0]));return n.update(t,e),n.coefficients}function o(t,r){var s,a;if(!V(t))throw new TypeError(F("invalid argument. First argument must be an ndarray. Value: `%s`.",t));if((s=t.shape)[s.length-1]!==e)throw new TypeError(F("invalid argument. First argument must be an ndarray whose last dimension is of size %u. Actual size: `%u`.",e,s[s.length-1]));if(a="label",arguments.length>1){if("probability"===r){if("log"!==i.loss&&"modifiedHuber"!==i.loss)throw new Error(F('invalid argument. Second argument is incompatible with model loss function. Probability predictions are only supported when the loss function is one of the following: "%s". Model loss function: `%s`.',["log","modifiedHuber"].join('", "'),i.loss))}else if("label"!==r&&"linear"!==r)throw new TypeError(F('invalid argument. Second argument must be a string value equal to either "label", "probability", or "linear". Value: `%s`.',r));a=r}return n.predict(t,a)}},K}function lt(){if($)return Z;$=1;var t=h,e=g,r=L;return Z=function(n,i,s){return(s?r:e)("float64",new t(n*i),[n,i],[i,1],0,"row-major")}}var pt,ft,mt=["euclidean","correlation","cosine"],ct=["forgy","sample","kmeans++"];var ht,gt,vt,bt,jt,yt,wt,_t,Et,xt,Rt,Tt,Ot,zt,Vt,kt,Ft,Lt,Pt,At,Mt,St,qt,Ht,Nt,Wt,Bt,It,Ct,Dt,Gt,Yt,Jt,Kt,Qt,Ut,Xt,Zt,$t,te,ee,re,ne,ie,se,ae,oe,de,ue,le,pe,fe,me,ce,he={forgy:["forgy",1],sample:["sample",1],"kmeans++":["kmeans++",1,1]};function ge(){if(gt)return ht;gt=1;var t=A;return ht=function(e,r,n,i){var s,a,o,d;for(a=0,s=i,d=0;d<e;d++)a+=(o=r[s])*o,s+=n;for(a=t(a),s=i,d=0;d<e;d++)r[s]/=a;return r}}function ve(){if(bt)return vt;bt=1;var t=ge();return vt=function(e){var r,n,i,s,a,o,d;for(r=e.data,a=e.shape[0],o=e.shape[1],n=e.strides[0],i=e.strides[1],s=e.offset,d=0;d<a;d++)t(o,r,i,s),s+=n;return e}}function be(){if(yt)return jt;return yt=1,jt=function(t,e,r,n,i,s,a,o,d,u){var l,p,f,m;for(l=n,p=a,f=u,m=0;m<t;m++)e[l]=(e[l]-i[p])/o[f],l+=r,p+=s,f+=d;return e}}function je(){if(_t)return wt;_t=1;var t=be();return wt=function(e,r){var n,i,s,a,o,d,u;for(n=e.data,o=e.shape[0],d=e.shape[1],i=e.strides[0],s=e.strides[1],a=e.offset,u=0;u<o;u++)t(d,n,s,a,r,2,0,r,2,1),a+=i;return e}}function ye(){if(zt)return Ot;zt=1;var t=function(){if(Tt)return Rt;Tt=1;var t=A;return Rt=function(e,r,n,i,s,a,o){var d,u,l,p,f;for(d=i,u=o,p=0,f=0;f<e;f++)p+=(l=r[d]-s[u])*l,d+=n,u+=a;return t(p)}}();return Ot=function(e,r,n,i,s,a,o){var d=t(e,r,n,i,s,a,o);return d*d}}function we(){if(kt)return Vt;return kt=1,Vt=function(t,e,r,n,i,s,a){var o,d,u,l;for(o=n,d=a,u=0,l=0;l<t;l++)u+=e[o]*i[d],o+=r,d+=s;return u}}function _e(){if(Lt)return Ft;Lt=1;var t=we();return Ft=function(e,r,n,i,s,a,o){var d=1-t(e,r,n,i,s,a,o);return d*d}}function Ee(){if(At)return Pt;At=1;var t=we();return Pt=function(e,r,n,i,s,a,o){var d=1-t(e,r,n,i,s,a,o);return d*d}}function xe(){if(Wt)return Nt;Wt=1;var t=H;return Nt=function(e,r,n,i,s,a,o,d,u){var l,p,f,m;for(l=t,m=0;m<r;m++)(f=e(n,i,1,a,o,d,u))<l&&(l=f,p=m),a+=s;return p}}function Re(){if(It)return Bt;return It=1,Bt=function(t,e,r,n,i,s,a,o){var d,u;for(u=0;u<t;u++)d=r[i],d+=(s[o]-d)/e,r[i]=d,i+=n,o+=a;return r}}function Te(){if(Yt)return Gt;Yt=1;var t=P.ndarray,e=lt(),r=ve(),n=je(),i=function(){if(xt)return Et;xt=1;var t=M.factory,e=u.ndarray;return Et=function(r,n,i){var s,a,o,d,u,l,p,f,m,c,h;for(m=r.shape[0],c=r.shape[1],a=r.data,l=r.strides[1],p=r.offset,o=n.data,d=n.strides[0],u=n.strides[1],s=[],h=0;h<n.shape[0];h++)s.push(h);for(f=m===s.length?s:t({seed:i,size:m,mutate:!1,replacement:!1})(s),h=0;h<m;h++)e(c,o,u,d*f[h],a,l,p);return r}}(),s=function(){if(St)return Mt;St=1;var t=S.factory,e=q.factory,r=H,n=u.ndarray,i=ye(),s=_e(),a=Ee();function o(t,e,r,n,i,s){var a,o,d,u,l;for(u=i.data,a=(d=i.strides[0])*s,o=0,l=0;l<r;l++)t[l]=e(n,u,1,o,u,1,a),o+=d;return t}return Mt=function(d,u,l,p,f){var m,c,h,g,v,b,j,y,w,_,E,x,R,T,O,z,V,k,F,L,P,A,M,S,q,H,N,W;if(S=d.shape[0],g=d.shape[1],y=u.shape[0],x=d.data,V=d.strides[0],k=d.strides[1],F=d.offset,R=u.data,O=u.strides[0],z=u.strides[1],j=e({seed:f}),h=t({seed:j()}),j=j.normalized,E="cosine"===l?s:"correlation"===l?a:i,M=h(0,y-1),1===S)return n(g,R,z,O*M,x,k,F);for(m=[M],L=new Array(g),v=new Array(2*y),T=0,H=0;H<y;H++)v[T]=r,v[T+1]=0,T+=2;for(b=new Array(y),N=1;N<S;N++){for(o(L,E,y,g,u,m[N-1]),w=0,T=0,H=0;H<y;H++)L[H]<v[T]?(v[T]=L[H],v[T+1]=N-1,w+=L[H]):w+=v[T],T+=2;for(b[0]=v[0]/w,T=2,H=1;H<y;H++)b[H]=b[H-1]+v[T]/w,T+=2;for(_=r,P=-1,W=0;W<p;W++){for(M=-1;-1===M;)for(q=j(),H=0;H<y;H++)if(q<b[H]){M=H;break}for(w=0,c=O*M,T=0,H=0;H<y;H++)(A=E(g,R,1,O*H,R,1,c))<v[T]?w+=A:w+=v[T],T+=2;w<_&&(_=w,P=M)}m.push(P)}for(H=0;H<S;H++)n(g,R,z,O*m[H],x,k,F),F+=V;return d}}(),a=function(){if(Ht)return qt;Ht=1;var t=S.factory,e=N;return qt=function(r,n,i){var s,a,o,d,u,l,p,f,m,c,h,g,v,b,j,y;for(v=r.shape[0],b=r.shape[1],a=r.data,p=r.strides[0],f=r.strides[1],c=r.offset,d=n.data,o=n.shape[0],u=n.strides[0],l=n.strides[1],g=n.offset,s=t(0,v-1,{seed:i}),m=[],j=0;j<v*b;j++)m.push(e());for(j=0;j<o;j++){for(h=b*s(),y=0;y<b;y++)m[h+y](d[g+l*y]);g+=u}for(h=0,j=0;j<v;j++){for(y=0;y<b;y++)a[c+f*y]=m[h](),h+=1;c+=p}return r}}(),o=function(){if(Dt)return Ct;Dt=1;var t=xe(),e=Re();return Ct=function(r,n,i,s,a){var o,d,u,l,p,f,m,c,h,g,v,b;for(g=n.shape[0],o=n.shape[1],l=r.shape[0],d=n.data,p=n.strides[0],u=r.data,f=r.strides[0],c=0,b=0;b<l;b++)m=p*(v=t(a,g,o,d,p,0,u,1,c)),h=i.get(v,0)+1,e(o,h,d,1,m,u,1,c),s(v,a(o,d,1,m,u,1,c)),c+=f}}();return Gt=function(d,u,l,p,f,m){var c,h;return h=d.shape[1],function(g){void 0===c&&((c=e(m.init[1],h,!0)).count=0);if(c.count<m.init[1]&&(t(h,g.data,g.strides[0],g.offset,c.data,c.strides[1],c.strides[0]*c.count),c.count+=1,c.count<m.init[1]))return!1;m.normalize&&("cosine"===m.metric?c=r(c):"correlation"===m.metric&&(c=n(c,p())));d="forgy"===m.init[0]?a(d,c,m.seed):"sample"===m.init[0]?i(d,c,m.seed):s(d,c,m.metric,m.init[2],m.seed);return o(c,d,u,l,f),!0}}}function Oe(){if(Zt)return Xt;Zt=1;var t=e.isPrimitive,n=z,a=r,o=i,d=s,l=V,p=k,f=F,m=u,c=lt(),v=function(){if(et)return tt;et=1;var t=P.ndarray;return tt=function(e,r){var n,i,s,a,o,d,u,l,p,f,m;for(p=r.shape[0],f=r.shape[1],n=r.data,i=e.data,s=r.strides[0],a=r.strides[1],o=e.strides[0],d=e.strides[1],u=r.offset,l=e.offset,m=0;m<p;m++)t(f,n,a,u,i,d,l),u+=s,l+=o;return e}}(),b=function(){if(nt)return rt;nt=1;var t=h,e=g,r=L;return rt=function(n,i){return(i?r:e)("float64",new t(n),[n],[1],0,"row-major")}}(),j=function(){if(st)return it;st=1;var t=P.ndarray;return it=function(e,r){return t(r.shape[0],r.data,r.strides[0],r.offset,e.data,e.strides[0],e.offset),e}}(),y=function(){if(ft)return pt;ft=1;var t=R,r=T,n=E.isPrimitive,i=x,a=e.isPrimitive,o=O,d=s,u=mt,l=ct;return pt=function(e,s){if(!t(s))return new TypeError(d("invalid argument. Options argument must be an object. Value: `%s`.",s));if(r(s,"metric")&&(e.metric=s.metric,!o(u,e.metric)))return new TypeError(d('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"metric",u.join('", "'),e.metric));if(r(s,"init")){if(!i(s.init))return new TypeError(d("invalid option. `%s` option must be an array-like object. Option: `%s`.","init",s.init));if(!o(l,s.init[0]))return new TypeError(d('invalid option. `%s` option method must be one of the following: "%s". Option: `%s`.',"init",l.join('", "'),s.init[0]));if(e.init[0]=s.init[0],s.init.length>1&&(e.init[1]=s.init[1],!a(e.init[1])))return new TypeError(d("invalid option. First `%s` parameter option must be a positive integer. Option: `%s`.","init",e.init[1]));if(s.init.length>2&&(e.init[2]=s.init[2],!a(e.init[2])))return new TypeError(d("invalid option. Second `%s` parameter option must be a positive integer. Option: `%s`.","init",e.init[2]))}return r(s,"normalize")&&(e.normalize=s.normalize,!n(e.normalize))?new TypeError(d("invalid option. `%s` option must be a boolean. Option: `%s`.","normalize",e.normalize)):r(s,"copy")&&(e.copy=s.copy,!n(e.copy))?new TypeError(d("invalid option. `%s` option must be a boolean. Option: `%s`.","copy",e.copy)):(r(s,"seed")&&(e.seed=s.seed),null)}}(),w=he,_=Te(),M=function(){if(Kt)return Jt;Kt=1;var t=A;return Jt=function(e,r){var n,i;for(n=[],i=0;i<r;i++)n.push(0);return function(r,i){var s,a,o;return o=e.get(r,0)+1,e.set(r,0,o),e.set(r,1,e.get(r,1)+i),a=e.get(r,2),a+=(s=i-a)/o,n[r]+=s*(i-a),e.set(r,2,a),e.set(r,3,t(n[r]/(o-1))),e}}}(),S=function(){if(Ut)return Qt;Ut=1;var t=W,e=h;return Qt=function(r){var n,i,s,a,o;for(n=2*(s=new e(2*r)).BYTES_PER_ELEMENT,i=[],a=0,o=0;o<r;o++)i.push(t(new e(s.buffer,a,2))),a+=n;return function(t){var e;if(0===arguments.length)return s;for(e=0;e<r;e++)i[e](t.get(e));return s}},Qt}(),q=ye(),H=_e(),N=Ee(),B=xe(),I=Re(),C=ge(),D=ve(),G=be(),Y=je();function J(t,e){var r={};return r.centroids=c(t,e,!1),r.stats=c(t,4,!1),r}return Xt=function(){var e,r,i,s,u,h,g,E,x,R,T,O,z,V;if(n(arguments[0]))V=arguments[0].shape[0],E=arguments[0].shape[1],r=c(V,E,!0),r=v(r,arguments[0]),arguments.length>1&&(s=arguments[1],z=!0);else{if(!t(arguments[0]))throw new TypeError(d("invalid argument. First argument must either be a positive integer specifying the number of clusters or a matrix containing initial centroids. Value: `%s`.",arguments[0]));if(V=arguments[0],!t(E=arguments[1]))throw new TypeError(d("invalid argument. Argument specifying number of dimensions must be a positive integer. Value: `%s`.",E));arguments.length>2&&(s=arguments[2],z=!0)}if((R={metric:"euclidean",init:w["kmeans++"].slice(),seed:l(),normalize:!0,copy:!0}).init[1]=V,R.init[2]=2+p(f(V)),z&&(O=y(R,s)))throw O;if(R.init[1]<V)throw new RangeError(d("invalid option. First `%s` parameter option must be greater than or equal to the number of clusters. Options: `%f`.","init",R.init[1]));return u=J(V,E),g=c(V,4,!0),e=M(g,V),"cosine"===R.metric?(x=H,R.copy&&(h=b(E,!0))):"correlation"===R.metric?(x=N,R.normalize&&(i=S(E)),R.copy&&(h=b(E,!0))):x=q,void 0===r?(r=c(V,E,!0),T=_(r,g,e,i,x,R)):v(u.centroids,r),o(k,"seed",R.seed),o(k,"predict",F),k;function k(t){var n,s,o,l,p,f,c,v,b,y,w;if(0===arguments.length)return T?null:u;if(!a(v=t))throw new TypeError(d("invalid argument. Must provide a one-dimensional ndarray. Value: `%s`.",v));if(v.shape[0]!==E)throw new Error(d("invalid argument. Vector length must match centroid dimensions. Expected: `%u``. Actual: `%u``.",E,v.shape[0]));if(i&&i(v),T){if(!1===T(v))return null;T=void 0}else R.normalize&&("cosine"===R.metric?(R.copy&&(v=j(h,v)),C(E,v.data,v.strides[0],v.offset)):"correlation"===R.metric&&(R.copy&&(v=j(h,v)),o=i(),G(E,v.data,v.strides[0],v.offset,o,2,0,o,2,1))),n=r.data,p=r.strides[0],s=v.data,l=v.strides[0],f=v.offset,c=p*(w=B(x,V,E,n,p,0,s,l,f)),b=g.get(w,0)+1,I(E,b,n,1,c,s,l,f),y=x(E,n,1,c,s,l,f),e(w,y);return m(r.length,r.data,1,u.centroids.data,1),m(g.length,g.data,1,u.stats.data,1),u}function F(t,e){var s,o,u,l,p,f,m,h,g,j,y;if(arguments.length>1){if(!a(t))throw new TypeError(d("invalid argument. Output argument must be a one-dimensional ndarray. Value: `%s`.",t));g=t,h=e}else h=t;if(!n(h))throw new TypeError(d("invalid argument. Must provide a two-dimensional ndarray. Value: `%s`.",h));if(h.shape[1]!==E)throw new Error(d("invalid argument. Number of matrix columns must match centroid dimensions. Expected: `%u`. Actual: `%u`.",E,h.shape[1]));if(void 0===g)g=b(h.shape[0],!1);else if(g.length!==h.shape[0])throw new Error(d("invalid argument. Output vector length must match the number of data points. Expected: `%u`. Actual: `%u`.",h.shape[0],g.length));if(T)return null;for(u=h.shape[0],R.normalize&&("cosine"===R.metric?(R.copy&&(h=v(c(u,E,!0),h)),h=D(h)):"correlation"===R.metric&&(R.copy&&(h=v(c(u,E,!0),h)),h=Y(h,i()))),o=r.data,f=r.strides[0],s=h.data,l=h.strides[0],p=h.strides[1],m=h.offset,y=0;y<u;y++)j=B(x,V,E,o,f,0,s,p,m),g.set(y,j),m+=l;return g}},Xt}function ze(){if(ie)return ne;ie=1;var t=e,r=E,n=i,a=s,o=m,d=re?ee:(re=1,ee=function(t,e){var r,n=t.length,i=0;for(r=0;r<n;r++)i+=t[r]*e[r];return i});function u(e,n){var i;if(!(this instanceof u))return new u(e,n);if(!t(e))throw new TypeError(a("invalid argument. First argument must be a positive integer. Value: `%s`.",e));if(!r(n))throw new TypeError(a("invalid argument. Second argument must be a boolean. Value: `%s`.",n));for(this.scale=1,this.norm=0,this.intercept=n,this.nWeights=e+(this.intercept?1:0),this._data=new Array(this.nWeights),i=0;i<this.nWeights;i++)this._data[i]=0}return n(u.prototype,"scaleTo",(function(t){var e;if(this.scale<1e-11){for(e=0;e<this.nWeights;e++)this._data[e]*=this.scale;this.scale=1}if(this.norm*=o(t,2),!(t>0))throw new RangeError(a("unexpected error. Scaling weight vector by nonpositive value, likely due to too large value of eta * lambda. Value: `%f`.",t));this.scale*=t})),n(u.prototype,"add",(function(t,e){var r,n,i;for(n=0,void 0===e&&(e=1),i=0;i<t.length;i++)r=t[i]*e,n+=this._data[i]*r,this._data[i]=this._data[i]+r/this.scale;this.intercept&&(r=1*e,n+=this._data[i]*r,this._data[i]=this._data[i]+r/this.scale),this.norm+=(d(t,t)+(this.intercept?1:0))*o(e,2)+2*this.scale*n})),n(u.prototype,"innerProduct",(function(t){var e,r=0;for(e=0;e<t.length;e++)r+=this._data[e]*t[e];return r+=this.intercept?this._data[e]:0,r*=this.scale})),ne=u}function Ve(){if(ae)return se;ae=1;var t=p;return se=function(e,r,n){var i;r>0&&(i=1-n*r,e.scaleTo(t(i,1e-7)))},se}var ke,Fe,Le,Pe,Ae,Me,Se={epsilon:.1,eta0:.02,intercept:!0,lambda:.001,learningRate:"basic",loss:"squaredError"};function qe(){if(Pe)return Le;Pe=1;var t=B,e=s,r=I,n=a,o=i,d=ze(),u=function(){if(de)return oe;de=1;var t=Ve();return oe=function(e,r,n,i,s,a){var o=e.innerProduct(r)-n;t(e,s,i),o>a?e.add(r,-i):o<-a&&e.add(r,+i)},oe}(),l=function(){if(le)return ue;le=1;var t=Ve();return ue=function(e,r,n,i,s){var a=n-e.innerProduct(r);t(e,s,i),e.add(r,i*a)},ue}(),p=function(){if(fe)return pe;fe=1;var t=Ve();return pe=function(e,r,n,i,s,a){var o=e.innerProduct(r)-n;t(e,s,i),o>a?e.add(r,-i):o<-a?e.add(r,+i):e.add(r,-i*o)},pe}(),f=function(){if(ce)return me;ce=1;var t=s;return me=function(e,r,n){var i,s;switch(i=1,e){case"basic":s=function(){var t=1e3/(i+1e3);return i+=1,t};break;case"constant":s=function(){return i+=1,r};break;case"pegasos":s=function(){var t=1/(n*i);return i+=1,t};break;default:throw new Error(t('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"learningRate",["basic","constant","pegasos"].join('", "'),e))}return s},me}(),m=Se,c=function(){if(Fe)return ke;Fe=1;var t=y.isPrimitive,e=w.isPrimitive,r=E.isPrimitive,n=R,i=C.isPrimitive,a=T,o=s;return ke=function(s,d){return n(d)?a(d,"epsilon")&&(s.epsilon=d.epsilon,!e(s.epsilon))?new TypeError(o("invalid option. `%s` option must be a positive number. Option: `%s`.","epsilon",s.epsilon)):a(d,"eta0")&&(s.eta0=d.eta0,!e(s.eta0))?new TypeError(o("invalid option. `%s` option must be a positive number. Option: `%s`.","eta0",s.eta0)):a(d,"lambda")&&(s.lambda=d.lambda,!t(s.lambda))?new TypeError(o("invalid option. `%s` option must be a nonnegative number. Option: `%s`.","lambda",s.lambda)):a(d,"learningRate")&&(s.learningRate=d.learningRate,!i(s.learningRate))?new TypeError(o("invalid option. `%s` option must be a string. Option: `%s`.","learningRate",s.learningRate)):a(d,"loss")&&(s.loss=d.loss,!i(s.loss))?new TypeError(o("invalid option. `%s` option must be a string. Option: `%s`.","loss",s.loss)):a(d,"intercept")&&(s.intercept=d.intercept,!r(s.intercept))?new TypeError(o("invalid option. `%s` option must be a boolean. Option: `%s`.","intercept",s.intercept)):null:new TypeError(o("invalid argument. Options argument must be an object. Value: `%s`.",d))}}();return Le=function(i){var s,a,h,g,v,b,j;if(b=r(m),arguments.length>0&&(j=c(b,i)))throw j;switch(h=null,b.loss){case"epsilonInsensitive":a=u;break;case"huber":a=p;break;case"squaredError":a=l;break;default:throw Error(e('invalid option. `%s` option must be one of the following: "%s". Option: `%s`.',"loss",["epsilonInsensitive","huber","squaredError"].join('", "'),b.loss))}function v(r,n){var i;if(!t(r))throw new TypeError(e("invalid argument. First argument must be an array. Value: `%s`.",r));if(h||(h=new d(r.length,b.intercept),s=b.intercept?h.nWeights-1:h.nWeights),r.length!==s)throw new TypeError(e("invalid argument. First argument must be an array of length %u. Value: `%s`.",s,r));i=g(),a(h,r,n,i,b.lambda,b.epsilon)}return g=f(b.learningRate,b.eta0,b.lambda),n(v,"coefs",y),o(v,"predict",w),v;function y(){var t,e;for(t=new Array(h.nWeights),e=0;e<t.length;e++)t[e]=h._data[e]*h.scale;return t}function w(r){if(!t(r)||r.length!==s)throw new TypeError(e("invalid argument. First argument must be an array of length %u. Value: `%s`.",s||0,r));return h.innerProduct(r)}},Le}var He=t,Ne={};He(Ne,"incrBinaryClassification",function(){if(X)return U;X=1;var t=ut();return U=t}()),He(Ne,"incrkmeans",function(){if(te)return $t;te=1;var t=Oe();return $t=t}()),He(Ne,"incrSGDRegression",function(){if(Me)return Ae;Me=1;var t=qe();return Ae=t}());var We=Ne,Be={};t(Be,"incr",We);export{Be as default,We as incr};
//# sourceMappingURL=index.mjs.map
